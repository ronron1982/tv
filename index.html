<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>特斯拉串流播放器 v3 </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #000;
            color: #fff;
            font-family: Arial, sans-serif;
        }
        
        #app {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        /* 視頻容器 - 簡化樣式，避免不必要的複雜布局 */
        #videoContainer {
            width: 100%;
            height: 100%;
            position: relative;
            background-color: #000;
        }
        
        /* 控制按鈕 - 最小化為只有播放按鈕 */
        .play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.5);
            color: white;
            border: 2px solid white;
            padding: 20px 40px;
            font-size: 20px;
            cursor: pointer;
            z-index: 10;
        }
        
        /* URL 輸入區域 */
        #urlContainer {
            position: absolute;
            bottom: 20px;
            left: 0;
            width: 100%;
            padding: 10px;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            gap: 10px;
        }
        
        #urlInput {
            flex: 1;
            padding: 10px;
            font-size: 16px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }
        
        #playBtn {
            padding: 10px 20px;
            background: #2196F3;
            color: white;
            border: none;
            font-size: 16px;
            cursor: pointer;
        }
        
        /* 直播提示 */
        #liveIndicator {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            font-size: 14px;
            border-radius: 4px;
            display: none;
        }
        
        /* 載入提示 */
        #loadingIndicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 20px;
            z-index: 100;
        }
        
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="videoContainer">
            <!-- 使用iframe作為播放容器 -->
            <iframe id="playerFrame" allowfullscreen allow="autoplay; fullscreen"></iframe>
            
            <!-- 載入提示器 -->
            <div id="loadingIndicator">載入中...</div>
            
            <!-- 直播提示器 -->
            <div id="liveIndicator">直播中</div>
            
            <!-- URL 輸入區域 -->
            <div id="urlContainer">
                <input type="text" id="urlInput" placeholder="輸入視頻串流網址..." value="http://php.jdshipin.com:8880/TVOD/iptv.php?id=fct2">
                <button id="playBtn">播放</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 基本元素引用
            const playerFrame = document.getElementById('playerFrame');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const liveIndicator = document.getElementById('liveIndicator');
            const urlInput = document.getElementById('urlInput');
            const playBtn = document.getElementById('playBtn');
            
            // 直接播放指定串流
            playStream('http://php.jdshipin.com:8880/TVOD/iptv.php?id=fct2');
            
            // 創建播放器
            function playStream(url) {
                if (!url) return;
                
                // 顯示加載中提示
                showLoading(true);
                
                // 簡單的播放頁面，適用於特斯拉瀏覽器
                const playerHtml = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
                        <title>串流播放器</title>
                        <style>
                            body, html {
                                margin: 0;
                                padding: 0;
                                width: 100%;
                                height: 100%;
                                background: #000;
                                overflow: hidden;
                            }
                            video {
                                width: 100%;
                                height: 100%;
                                object-fit: contain;
                            }
                            #playButton {
                                position: absolute;
                                top: 50%;
                                left: 50%;
                                transform: translate(-50%, -50%);
                                padding: 20px 40px;
                                background: rgba(0, 0, 0, 0.7);
                                color: white;
                                font-size: 24px;
                                border: 2px solid white;
                                cursor: pointer;
                                z-index: 10;
                            }
                        </style>
                    </head>
                    <body>
                        <video id="videoPlayer" controls autoplay playsinline webkit-playsinline>
                            <source src="${url}" type="application/x-mpegURL">
                            您的瀏覽器不支援視頻播放
                        </video>
                        <button id="playButton" onclick="document.getElementById('videoPlayer').play()">點擊播放</button>
                        
                        <script>
                            const video = document.getElementById('videoPlayer');
                            const playButton = document.getElementById('playButton');
                            
                            // 嘗試自動播放
                            video.addEventListener('canplay', function() {
                                video.play().then(() => {
                                    playButton.style.display = 'none';
                                    window.parent.postMessage('playing', '*');
                                }).catch(err => {
                                    console.log('需要用戶交互才能播放');
                                    playButton.style.display = 'block';
                                });
                            });
                            
                            // 播放事件
                            video.addEventListener('playing', function() {
                                playButton.style.display = 'none';
                                window.parent.postMessage('playing', '*');
                            });
                            
                            // 錯誤處理
                            video.addEventListener('error', function() {
                                console.error('視頻播放錯誤');
                                window.parent.postMessage('error', '*');
                            });
                            
                            // 特斯拉瀏覽器特殊處理
                            if (/Tesla|QtCarBrowser/i.test(navigator.userAgent)) {
                                document.body.addEventListener('click', function() {
                                    if (video.paused) {
                                        video.play().catch(err => console.error('播放失敗:', err));
                                    }
                                });
                            }
                        </script>
                    </body>
                    </html>
                `;
                
                // 使用data URL加載HTML內容
                const dataUrl = 'data:text/html;charset=utf-8,' + encodeURIComponent(playerHtml);
                playerFrame.src = dataUrl;
                
                // 監聽來自iframe的消息
                window.addEventListener('message', function(event) {
                    if (event.data === 'playing') {
                        console.log('視頻開始播放');
                        showLoading(false);
                        liveIndicator.style.display = 'block';
                    } else if (event.data === 'error') {
                        console.error('播放錯誤');
                        showLoading(false);
                        alert('串流播放失敗，請檢查網址是否正確');
                    }
                });
            }
            
            // 顯示/隱藏載入提示
            function showLoading(visible) {
                loadingIndicator.style.display = visible ? 'block' : 'none';
            }
            
            // 按鈕事件監聽
            playBtn.addEventListener('click', function() {
                const url = urlInput.value.trim();
                if (url) {
                    playStream(url);
                } else {
                    alert('請輸入有效的串流網址');
                }
            });
            
            // 回車鍵觸發播放
            urlInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const url = urlInput.value.trim();
                    if (url) {
                        playStream(url);
                    }
                }
            });
            
            // 檢測特斯拉瀏覽器
            const isTesla = /Tesla|QtCarBrowser/i.test(navigator.userAgent);
            if (isTesla) {
                console.log('特斯拉瀏覽器模式');
                // 簡化特斯拉瀏覽器的交互
                document.body.style.touchAction = 'none';
            }
        });
    </script>
</body>
</html>
